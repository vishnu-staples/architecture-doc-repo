{
  "feedName": "apim-notification",
  "version": "1.0",
  "source": {
    "name": "Azure Blob Storage",
    "type": "BlobStore",
    "endpoint": "https://storageaccount.blob.core.windows.net",
    "path": "incoming/orders",
    "credentials": {
      "containerName": "orders",
      "connectionString": "{@JobSecrets.blobConnection}"
    }
  },
  "destinations": [
    {
      "id": 1,
      "name": "Internal SFTP for Processing",
      "type": "Internal-SFTP",
      "path": "{@AppSettings.sftpintroot}/{@Message.accountID}/orders/pending"
    },
    {
      "id": 2,
      "name": "Order Notification API",
      "type": "Internal-APIM",
      "TargetUrl": "https://api.example.com/v1/orders/notify",
      "TimeoutMs": "30000",
      "RepeatAPI": "3",
      "credentials": {
        "OAuthScope": "api://order-service/.default"
      }
    }
  ],
  "actions": [
    {
      "id": 1,
      "type": "ReadFile",
      "sourceFile": "{@JobSettings.source.path}/{@Message.fileName}"
    },
    {
      "id": 2,
      "type": "WriteFile",
      "sourceStream": "{@JobSettings.actions.1.outputStream}",
      "outputFile": "{@JobSettings.destinations.1.path}/{@Message.fileName}"
    },
    {
      "id": 3,
      "type": "Notification",
      "sourceFile": "{@JobSettings.destinations.1.path}/{@Message.fileName}",
      "outputFile": "{@JobSettings.destinations.2.path}",
      "eventType": "Succeeded",
      "eventAccountId": "{@Message.accountID}",
      "eventCorrelationId": "{@Message.correlationId}"
    }
  ]
}
