{
  "feedName": "rsa-encrypt-multi-dest",
  "version": "1.0",
  "source": {
    "name": "Vendor SFTP Server",
    "type": "Vendor-SFTP",
    "host": "sftp.partner.com",
    "port": "22",
    "path": "/exports/sensitive",
    "credentials": {
      "type": "SSHKey",
      "username": "{@JobSecrets.partnerUser}",
      "sshkey": "{@AppSettings.jobsettingsfolder}/partner_id_rsa"
    }
  },
  "destinations": [
    {
      "id": 1,
      "name": "Azure Blob Storage - Primary",
      "type": "BlobStore",
      "endpoint": "https://primarystorage.blob.core.windows.net",
      "path": "secure/encrypted",
      "credentials": {
        "containerName": "secure-data",
        "connectionString": "{@JobSecrets.primaryBlobConnection}"
      }
    },
    {
      "id": 2,
      "name": "Google Cloud Storage - Backup",
      "type": "GCP",
      "bucketName": "backup-bucket",
      "path": "encrypted-backups",
      "servicetype": "service_account",
      "projectID": "backup-project",
      "privateKeyID": "{@JobSecrets.gcpKeyId}",
      "clientEmail": "backup-service@backup-project.iam.gserviceaccount.com",
      "clientID": "987654321098765432109",
      "authUri": "https://accounts.google.com/o/oauth2/auth",
      "tokenUri": "https://oauth2.googleapis.com/token",
      "authProvider": "https://www.googleapis.com/oauth2/v1/certs",
      "clientCertUrl": "https://www.googleapis.com/robot/v1/metadata/x509/backup-service%40backup-project.iam.gserviceaccount.com",
      "universeDomain": "googleapis.com",
      "credentials": {
        "privateKey": "{@JobSecrets.gcpPrivateKey}"
      }
    }
  ],
  "actions": [
    {
      "id": 1,
      "type": "ReadFile",
      "sourceFile": "{@JobSettings.source.path}/{@Message.fileName}"
    },
    {
      "id": 2,
      "type": "RSA-Encrypt",
      "sourceStream": "{@JobSettings.actions.1.outputStream}",
      "keyFile": "{@AppSettings.jobsettingsfolder}/rsa_public.pem"
    },
    {
      "id": 3,
      "type": "WriteFile",
      "sourceStream": "{@JobSettings.actions.2.outputStream}",
      "outputFile": "{@JobSettings.destinations.1.path}/{@Message.fileName.name}.enc"
    },
    {
      "id": 4,
      "type": "WriteFile",
      "sourceStream": "{@JobSettings.actions.2.outputStream}",
      "outputFile": "{@JobSettings.destinations.2.path}/{@Message.fileName.name}.enc"
    }
  ]
}
